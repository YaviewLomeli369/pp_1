import{a9 as D,b as G,u as O,k as R,c as U,r as m,d as C,j as e,C as v,O as N,V as g,ag as u,f as w,h as x,aG as V,aH as B,aI as S,aJ as E,a5 as J,B as h,W as H,q as i,s as l,aK as K,g as Q,e as L,av as A}from"./index-68JtM4Cd.js";import{N as I,F as T}from"./footer-Z09FTuhT.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=D("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function X(){const{user:a,isLoading:y}=G(),[,q]=O(),{toast:t}=R(),F=U(),[b,j]=m.useState(!1),[c,d]=m.useState({username:"",email:""}),[r,o]=m.useState({currentPassword:"",newPassword:"",confirmPassword:""});if(m.useEffect(()=>{a&&d({username:a.username||"",email:a.email||""})},[a]),!y&&!a)return q("/login"),null;const p=C({mutationFn:async s=>await L(`/api/users/${a?.id}`,{method:"PUT",body:JSON.stringify(s)}),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/auth/me"]}),j(!1),t({title:"Perfil actualizado",description:"Tus datos han sido actualizados correctamente"})},onError:()=>{t({variant:"destructive",title:"Error",description:"No se pudo actualizar el perfil"})}}),f=C({mutationFn:async s=>await L("/api/auth/change-password",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{o({currentPassword:"",newPassword:"",confirmPassword:""}),t({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente"})},onError:()=>{t({variant:"destructive",title:"Error",description:"No se pudo cambiar la contraseña. Verifica tu contraseña actual."})}}),z=s=>{s.preventDefault(),p.mutate(c)},M=s=>{if(s.preventDefault(),r.newPassword!==r.confirmPassword){t({variant:"destructive",title:"Error",description:"Las contraseñas no coinciden"});return}if(r.newPassword.length<6){t({variant:"destructive",title:"Error",description:"La nueva contraseña debe tener al menos 6 caracteres"});return}f.mutate(r)},P=s=>{switch(s){case"superuser":return{label:"Super Administrador",color:"destructive",icon:A};case"admin":return{label:"Administrador",color:"default",icon:A};case"staff":return{label:"Staff",color:"secondary",icon:u};default:return{label:"Cliente",color:"outline",icon:u}}},n=P(a?a.role:"cliente");return y?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(I,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 navbar-fixed-body",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})})}),e.jsx(T,{})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(I,{}),e.jsxs("div",{className:"container mx-auto px-4 py-16",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Mi Perfil"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona tu información personal y configuración de cuenta"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Información General"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(u,{className:"h-12 w-12 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg",children:a?.username}),e.jsx("p",{className:"text-gray-600",children:a?.email}),e.jsxs(x,{variant:n.color,className:"mt-2",children:[e.jsx(n.icon,{className:"h-3 w-3 mr-1"}),n.label]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estado de cuenta:"}),e.jsx(x,{variant:a?.isActive?"default":"secondary",children:a?.isActive?"Activa":"Inactiva"})]})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(V,{defaultValue:"profile",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-2",children:[e.jsx(S,{value:"profile",children:"Información Personal"}),e.jsx(S,{value:"security",children:"Seguridad"})]}),e.jsx(E,{value:"profile",className:"mt-6",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Información Personal"]}),!b&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{j(!0),d({username:a?.username||"",email:a?.email||""})},children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Editar"]})]})}),e.jsx(w,{children:b?e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"username",children:"Nombre de Usuario"}),e.jsx(l,{id:"username",value:c.username,onChange:s=>d({...c,username:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(l,{id:"email",type:"email",value:c.email,onChange:s=>d({...c,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-4",children:[e.jsxs(h,{type:"submit",disabled:p.isPending,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),p.isPending?"Guardando...":"Guardar Cambios"]}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-gray-600",children:"Nombre de Usuario"}),e.jsx("p",{className:"font-medium",children:a?.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:a?.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-gray-600",children:"Rol"}),e.jsx("div",{children:e.jsxs(x,{variant:n.color,children:[e.jsx(n.icon,{className:"h-3 w-3 mr-1"}),n.label]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-gray-600",children:"Estado"}),e.jsx("div",{children:e.jsxs(x,{variant:a?.isActive?"default":"secondary",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),a?.isActive?"Cuenta Activa":"Cuenta Inactiva"]})})]})]})})})]})}),e.jsx(E,{value:"security",className:"mt-6",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Cambiar Contraseña"]})}),e.jsx(w,{children:e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"currentPassword",children:"Contraseña Actual"}),e.jsx(l,{id:"currentPassword",type:"password",value:r.currentPassword,onChange:s=>o({...r,currentPassword:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"newPassword",children:"Nueva Contraseña"}),e.jsx(l,{id:"newPassword",type:"password",value:r.newPassword,onChange:s=>o({...r,newPassword:s.target.value}),required:!0,minLength:6}),e.jsx("p",{className:"text-sm text-gray-500",children:"Mínimo 6 caracteres"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confirmPassword",children:"Confirmar Nueva Contraseña"}),e.jsx(l,{id:"confirmPassword",type:"password",value:r.confirmPassword,onChange:s=>o({...r,confirmPassword:s.target.value}),required:!0,minLength:6})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(h,{type:"submit",disabled:f.isPending,children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),f.isPending?"Actualizando...":"Cambiar Contraseña"]})})]})})]})})]})})]})]}),e.jsx(T,{})]})}export{X as default};
