ðŸ”¹ 1. Arreglar el 401 Unauthorized

En tu use-auth.ts asegÃºrate de que cada request lleve el token:

// use-auth.ts
import { useEffect, useState } from "react";
import { queryClient } from "./queryClient";

export function useAuth() {
  const [user, setUser] = useState(null);

  useEffect(() => {
    const token = localStorage.getItem("token");

    if (!token) return;

    queryClient("/api/auth/me", {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`, // ðŸ‘ˆ mandamos token
      },
    })
      .then((res) => setUser(res))
      .catch(() => setUser(null));
  }, []);

  return { user };
}


Cuando hagas login guarda el token:

localStorage.setItem("token", data.token);

ðŸ”¹ 2. Guardar URL absolutas al subir imÃ¡genes

En tu ObjectUploader.tsx cambia el onSuccess para que construya la URL final:

const handleUploadComplete = (result) => {
  if (!result.successful || result.successful.length === 0) return;

  const uploadedFile = result.successful[0];
  const relativeUrl = uploadedFile.response.body.url;

  // ðŸ‘‡ Generamos la URL completa
  const finalUrl = `${window.location.origin}${relativeUrl}`;

  console.log("âœ… Imagen subida:", finalUrl);

  // AquÃ­ actualizas tu producto o formulario
  onUpload(finalUrl);
};

ðŸ”¹ 3. Cleanup correcto de Uppy

En tu ObjectUploader.tsx reemplaza el cleanup:

useEffect(() => {
  const uppy = new Uppy({ autoProceed: true })
    .use(Dashboard, { target: '#uppy-dashboard-container' })
    .use(XHRUpload, { endpoint: '/api/objects/upload' });

  return () => {
    uppy.close(); // ðŸ‘ˆ correcto, no destroy()
  };
}, []);

ðŸ”¹ 4. Guardar imagen en productos

Cuando guardes un producto, asegÃºrate de usar la URL completa:

const newProduct = {
  name,
  price,
  image: uploadedImageUrl, // ðŸ‘ˆ viene del uploader con URL absoluta
};

await queryClient("/api/products", {
  method: "POST",
  body: newProduct,
  headers: {
    Authorization: `Bearer ${localStorage.getItem("token")}`,
  },
});


âœ… Con estos cambios:

Ya no tendrÃ¡s 401 porque todos los requests llevan el token.

Las imÃ¡genes se mostrarÃ¡n sin 404 porque tendrÃ¡n la URL completa.

Se elimina el warning de Uppy al desmontar.